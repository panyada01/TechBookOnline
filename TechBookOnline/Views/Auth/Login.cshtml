@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model TechBookOnline.Controllers.LoginRequest


@{
    ViewData["Title"] = "Login";
}

<div class="container mt-5">
    <h2>Login</h2>
    <form asp-action="Login" asp-controller="Auth" method="post">
        <div class="form-group mb-3">
            <label for="username">Username</label>
            <input asp-for="Username" class="form-control" required />
        </div>
        <div class="form-group mb-3">
            <label for="password">Password</label>
            <input asp-for="Password" type="password" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
    </form>

    @if (ViewBag.Error != null)
    {
        <div class="text-danger mt-2">@ViewBag.Error</div>
    }


    <div id="result" class="mt-3 text-danger"></div>
</div>

@section Scripts {
    <script>
        document.getElementById("loginForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            try {
                const response = await fetch("/Auth/Login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();

                if (response.ok) {
                    // Login successful
                    window.location.href = "/Books/Index";
                } else {
                    // Login failed
                    document.getElementById("result").innerText = result.message || "Login failed";
                }
            } catch (error) {
                console.error("Error:", error);
                document.getElementById("result").innerText = "Something went wrong!";
            }
        });
    </script>
}




